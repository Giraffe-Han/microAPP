import{_ as we,g as f,c as Ce,k as Ve,a as v,b as t,e as U,w as n,r as d,h as y,f as p,d as b,F as w,i as I,t as $,s as C,p as M,q as K,v as Q,o as i,D as xe,E as De}from"./index-Dm6bEu_Y.js";import{a as V}from"./index-ngrFHoWO.js";const Ue={class:"admin-page"},$e={key:0,class:"filter-section"},Se={class:"action-buttons"},Te={class:"data-list"},ze={class:"case-list"},Ne={style:{padding:"12px"}},Ie={class:"user-list"},Me={key:0,class:"detail-content"},Re={key:0,class:"detail-content"},Ee={style:{display:"flex","justify-content":"space-between","margin-bottom":"8px"}},Fe={style:{"font-weight":"bold"}},Le={style:{"margin-top":"8px"}},Be={style:{padding:"10px"}},Oe={style:{padding:"10px"}},Pe={style:{margin:"16px","padding-bottom":"30px"}},Ae={__name:"Index",setup(He){const S=f([]),T=f([]),H=f([]),R=f(!1),x=f(""),D=f(""),F=f(!1),z=f(!1),s=f(null),o=f(null),N=f(!1),L=f(0),W=[{text:"待处理",value:"待处理"},{text:"处理中",value:"处理中"},{text:"已完成",value:"已完成"},{text:"已取消",value:"已取消"}],X=Ce(()=>x.value&&D.value?`${q(x.value)} - ${q(D.value)}`:"全部时间"),q=a=>{const e=new Date(a);return`${e.getMonth()+1}/${e.getDate()}`},J=a=>{if(!a)return"";const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},g=a=>a||"-",Z=a=>a==="已完成"?"text-success":"text-warning",ee=a=>{const[e,r]=a;R.value=!1,x.value=e,D.value=r,B()},B=async()=>{try{const a={};x.value&&(a.startDate=x.value),D.value&&(a.endDate=D.value);const e=await V.get("/api/list",{params:a});S.value=e.data}catch(a){C("获取数据失败"),console.error(a)}},te=async()=>{try{const a=await V.get("/api/cases");T.value=a.data}catch(a){C("获取案例数据失败"),console.error(a)}},le=async()=>{try{const a=await V.get("/api/users");H.value=a.data}catch(a){C("获取用户数据失败"),console.error(a)}},ae=async a=>{const e=a.role==="admin"?"user":"admin";try{await V.post("/api/user/role",{id:a.id,role:e}),a.role=e,M("权限更新成功")}catch(r){C("权限更新失败"),console.error(r)}},oe=()=>{let a="/api/export?";x.value&&(a+=`startDate=${x.value.toISOString()}&`),D.value&&(a+=`endDate=${D.value.toISOString()}`),window.open(a,"_blank")},ne=a=>{s.value={...a},F.value=!0},se=a=>{o.value=JSON.parse(JSON.stringify(a)),o.value.media||(o.value.media=[]),o.value.highlights||(o.value.highlights=[]),o.value.coverType||(o.value.coverType="image"),z.value=!0},ue=()=>{o.value={title:"",description:"",location:"",date:"",fullDescription:"",coverType:"image",cover:"",media:[],highlights:[],categoryId:1,service:"无人机物流"},z.value=!0},j=async a=>{const e=new FormData;e.append("file",a.file);try{const r=await V.post("/api/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return r.data.success?r.data.url:(C("上传失败"),null)}catch(r){return console.error(r),C("上传出错"),null}},ie=async a=>{K({message:"上传中...",forbidClick:!0});const e=await j(a);Q(),e&&(o.value.cover=e,M("封面已上传"))},re=async(a,e)=>{K({message:"上传中...",forbidClick:!0});const r=await j(a);Q(),r&&(o.value.media[e].url=r,M("资源已上传"))},de=()=>{o.value.media.push({type:"image",url:""})},ve=a=>{o.value.media.splice(a,1)},pe=()=>{o.value.highlights.push("")},ce=a=>{o.value.highlights.splice(a,1)},me=async({selectedOptions:a})=>{const e=a[0].value;if(s.value)try{await V.post("/api/update",{id:s.value.id,status:e}),s.value.status=e;const r=S.value.findIndex(O=>O.id===s.value.id);r!==-1&&(S.value[r].status=e),M("状态更新成功"),N.value=!1}catch(r){C("更新状态失败"),console.error(r)}},fe=async()=>{if(o.value)try{if(o.value.id){await V.post("/api/cases/update",o.value);const a=T.value.findIndex(e=>e.id===o.value.id);a!==-1&&(T.value[a]=o.value)}else{const a=await V.post("/api/cases/create",o.value);o.value.id=a.data.id,T.value.unshift(o.value)}M("保存成功"),z.value=!1}catch(a){C("保存失败"),console.error(a)}};return Ve(()=>{B(),te(),le()}),(a,e)=>{const r=d("van-icon"),O=d("van-nav-bar"),u=d("van-cell"),ye=d("van-calendar"),m=d("van-button"),ge=d("van-empty"),_=d("van-cell-group"),P=d("van-tab"),_e=d("van-tag"),ke=d("van-tabs"),A=d("van-popup"),he=d("van-picker"),k=d("van-field"),E=d("van-radio"),G=d("van-radio-group"),Y=d("van-uploader"),be=d("van-form");return i(),v("div",Ue,[t(O,{title:"后台数据管理","left-arrow":"",onClickLeft:e[1]||(e[1]=l=>a.$router.push("/")),fixed:"",placeholder:""},{right:n(()=>[t(r,{name:"wap-home-o",size:"18",onClick:e[0]||(e[0]=l=>a.$router.push("/"))})]),_:1}),L.value===0?(i(),v("div",$e,[t(u,{title:"选择日期范围",value:X.value,"is-link":"",onClick:e[2]||(e[2]=l=>R.value=!0)},null,8,["value"]),t(ye,{show:R.value,"onUpdate:show":e[3]||(e[3]=l=>R.value=l),type:"range",onConfirm:ee},null,8,["show"]),y("div",Se,[t(m,{type:"primary",size:"small",block:"",onClick:B},{default:n(()=>[...e[17]||(e[17]=[p("查询",-1)])]),_:1}),t(m,{type:"success",size:"small",block:"",onClick:oe,style:{"margin-top":"8px"}},{default:n(()=>[...e[18]||(e[18]=[p("导出Excel",-1)])]),_:1})])])):U("",!0),t(ke,{active:L.value,"onUpdate:active":e[4]||(e[4]=l=>L.value=l),sticky:"","offset-top":"46"},{default:n(()=>[t(P,{title:"订单管理"},{default:n(()=>[y("div",Te,[S.value.length===0?(i(),b(ge,{key:0,description:"暂无数据"})):(i(),b(_,{key:1,inset:""},{default:n(()=>[(i(!0),v(w,null,I(S.value,l=>(i(),b(u,{key:l.id,title:l.serviceName||"未知服务",label:J(l.createTime),"is-link":"",onClick:c=>ne(l)},{value:n(()=>[y("span",{class:xe(Z(l.status))},$(l.status||"待处理"),3)]),_:2},1032,["title","label","onClick"]))),128))]),_:1}))])]),_:1}),t(P,{title:"案例管理"},{default:n(()=>[y("div",ze,[y("div",Ne,[t(m,{block:"",type:"primary",icon:"plus",onClick:ue},{default:n(()=>[...e[19]||(e[19]=[p("新增案例",-1)])]),_:1})]),t(_,{inset:""},{default:n(()=>[(i(!0),v(w,null,I(T.value,l=>(i(),b(u,{key:l.id,title:l.title,label:l.service,center:""},{value:n(()=>[t(m,{size:"small",type:"primary",icon:"edit",plain:"",onClick:De(c=>se(l),["stop"])},{default:n(()=>[...e[20]||(e[20]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:2},1032,["title","label"]))),128))]),_:1})])]),_:1}),t(P,{title:"用户管理"},{default:n(()=>[y("div",Ie,[t(_,{inset:""},{default:n(()=>[(i(!0),v(w,null,I(H.value,l=>(i(),b(u,{key:l.id,title:l.name||"未命名",label:l.phone,center:""},{value:n(()=>[t(_e,{type:l.role==="admin"?"danger":"primary",style:{"margin-right":"8px"}},{default:n(()=>[p($(l.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"]),t(m,{size:"small",type:l.role==="admin"?"default":"primary",plain:"",onClick:c=>ae(l)},{default:n(()=>[p($(l.role==="admin"?"设为用户":"设为管理"),1)]),_:2},1032,["type","onClick"])]),_:2},1032,["title","label"]))),128))]),_:1})])]),_:1})]),_:1},8,["active"]),t(A,{show:F.value,"onUpdate:show":e[6]||(e[6]=l=>F.value=l),position:"bottom",style:{height:"70%"},round:""},{default:n(()=>[s.value?(i(),v("div",Me,[t(_,{title:"基本信息"},{default:n(()=>[t(u,{title:"申请单号",value:g(s.value.id)},null,8,["value"]),t(u,{title:"申请时间",value:J(s.value.createTime)},null,8,["value"]),t(u,{title:"当前状态",value:s.value.status,"is-link":"",onClick:e[5]||(e[5]=l=>N.value=!0)},null,8,["value"]),s.value.serviceId==="6"?(i(),v(w,{key:0},[t(u,{title:"姓名",value:g(s.value.traineeName)},null,8,["value"]),t(u,{title:"联系电话",value:g(s.value.traineePhone)},null,8,["value"])],64)):(i(),v(w,{key:1},[t(u,{title:"联系人",value:g(s.value.contactName)},null,8,["value"]),t(u,{title:"联系电话",value:g(s.value.contactPhone)},null,8,["value"])],64))]),_:1}),t(_,{title:"服务详情"},{default:n(()=>[t(u,{title:"服务类型",value:g(s.value.serviceName)},null,8,["value"]),s.value.serviceId==="6"?(i(),v(w,{key:0},[t(u,{title:"性别",value:s.value.traineeGender==="male"?"男":"女"},null,8,["value"]),t(u,{title:"出生日期",value:g(s.value.traineeBirthday)},null,8,["value"]),t(u,{title:"身份证号",value:g(s.value.traineeIdCard)},null,8,["value"]),t(u,{title:"执照种类",value:g(s.value.examModel)},null,8,["value"]),t(u,{title:"证照级别",value:g(s.value.licenseLevel)},null,8,["value"]),t(u,{title:"有无基础",value:s.value.hasExperience==="yes"?"有":"无"},null,8,["value"])],64)):(i(),v(w,{key:1},[t(u,{title:"客户类型",value:s.value.customerType==="enterprise"?"企业":"个人"},null,8,["value"]),s.value.companyName?(i(),b(u,{key:0,title:"企业名称",value:s.value.companyName},null,8,["value"])):U("",!0),s.value.cargoType?(i(),b(u,{key:1,title:"货物类型",value:s.value.cargoType},null,8,["value"])):U("",!0),s.value.startAddress?(i(),b(u,{key:2,title:"起运地",value:s.value.startAddress},null,8,["value"])):U("",!0),s.value.endAddress?(i(),b(u,{key:3,title:"目的地",value:s.value.endAddress},null,8,["value"])):U("",!0)],64)),t(u,{title:"备注",label:g(s.value.remark)},null,8,["label"])]),_:1})])):U("",!0)]),_:1},8,["show"]),t(A,{show:N.value,"onUpdate:show":e[8]||(e[8]=l=>N.value=l),position:"bottom"},{default:n(()=>[t(he,{columns:W,onConfirm:me,onCancel:e[7]||(e[7]=l=>N.value=!1),title:"修改订单状态"})]),_:1},8,["show"]),t(A,{show:z.value,"onUpdate:show":e[16]||(e[16]=l=>z.value=l),position:"bottom",style:{height:"90%"},round:""},{default:n(()=>[o.value?(i(),v("div",Re,[t(be,{onSubmit:fe},{default:n(()=>[t(_,{title:"基本信息"},{default:n(()=>[t(k,{modelValue:o.value.title,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.title=l),label:"标题",placeholder:"请输入标题",required:""},null,8,["modelValue"]),t(k,{modelValue:o.value.description,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.description=l),label:"简介",type:"textarea",rows:"2",placeholder:"请输入简介"},null,8,["modelValue"]),t(k,{modelValue:o.value.location,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.location=l),label:"地点",placeholder:"请输入地点"},null,8,["modelValue"]),t(k,{modelValue:o.value.date,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.date=l),label:"时间",placeholder:"请输入时间"},null,8,["modelValue"])]),_:1}),t(_,{title:"封面设置"},{default:n(()=>[t(k,{name:"coverType",label:"封面类型"},{input:n(()=>[t(G,{modelValue:o.value.coverType,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.coverType=l),direction:"horizontal"},{default:n(()=>[t(E,{name:"image"},{default:n(()=>[...e[21]||(e[21]=[p("图片",-1)])]),_:1}),t(E,{name:"video"},{default:n(()=>[...e[22]||(e[22]=[p("视频",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(k,{modelValue:o.value.cover,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.cover=l),label:"封面地址",placeholder:"输入URL或上传"},null,8,["modelValue"]),t(k,{label:"上传封面"},{input:n(()=>[t(Y,{"after-read":l=>ie(l),"max-count":"1",accept:o.value.coverType==="video"?"video/*":"image/*"},{default:n(()=>[t(m,{icon:"plus",type:"primary",size:"small",plain:""},{default:n(()=>[p(" 上传"+$(o.value.coverType==="video"?"视频":"图片"),1)]),_:1})]),_:1},8,["after-read","accept"])]),_:1})]),_:1}),t(_,{title:"媒体资源 (图片/视频)"},{default:n(()=>[(i(!0),v(w,null,I(o.value.media,(l,c)=>(i(),v("div",{key:c,style:{padding:"10px","border-bottom":"1px dashed #eee"}},[y("div",Ee,[y("span",Fe,"资源 #"+$(c+1),1),t(m,{size:"mini",type:"danger",icon:"cross",onClick:h=>ve(c)},null,8,["onClick"])]),t(G,{modelValue:l.type,"onUpdate:modelValue":h=>l.type=h,direction:"horizontal",style:{"margin-bottom":"8px"}},{default:n(()=>[t(E,{name:"image"},{default:n(()=>[...e[23]||(e[23]=[p("图片",-1)])]),_:1}),t(E,{name:"video"},{default:n(()=>[...e[24]||(e[24]=[p("视频",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(k,{modelValue:l.url,"onUpdate:modelValue":h=>l.url=h,label:"地址",placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),y("div",Le,[t(Y,{"after-read":h=>re(h,c),accept:l.type==="video"?"video/*":"image/*"},{default:n(()=>[t(m,{icon:"plus",size:"mini",type:"default"},{default:n(()=>[p(" 上传"+$(l.type==="video"?"视频":"图片"),1)]),_:2},1024)]),_:2},1032,["after-read","accept"])])]))),128)),y("div",Be,[t(m,{size:"small",type:"primary",block:"",plain:"",icon:"plus",onClick:de},{default:n(()=>[...e[25]||(e[25]=[p("添加资源",-1)])]),_:1})])]),_:1}),t(_,{title:"项目亮点 (标签)"},{default:n(()=>[(i(!0),v(w,null,I(o.value.highlights,(l,c)=>(i(),v("div",{key:c,style:{display:"flex","align-items":"center",padding:"0 16px"}},[t(k,{modelValue:o.value.highlights[c],"onUpdate:modelValue":h=>o.value.highlights[c]=h,label:"标签 "+(c+1),placeholder:"输入标签内容"},null,8,["modelValue","onUpdate:modelValue","label"]),t(m,{size:"mini",type:"danger",icon:"cross",onClick:h=>ce(c),style:{"margin-left":"8px"}},null,8,["onClick"])]))),128)),y("div",Oe,[t(m,{size:"small",type:"primary",block:"",plain:"",icon:"plus",onClick:pe},{default:n(()=>[...e[26]||(e[26]=[p("添加标签",-1)])]),_:1})])]),_:1}),t(_,{title:"详细内容"},{default:n(()=>[t(k,{modelValue:o.value.fullDescription,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.fullDescription=l),label:"详细描述",type:"textarea",rows:"4",placeholder:"请输入详细描述",autosize:""},null,8,["modelValue"])]),_:1}),y("div",Pe,[t(m,{round:"",block:"",type:"primary","native-type":"submit"},{default:n(()=>[...e[27]||(e[27]=[p("保存修改",-1)])]),_:1})])]),_:1})])):U("",!0)]),_:1},8,["show"])])}}},je=we(Ae,[["__scopeId","data-v-9a2941c4"]]);export{je as default};
