# 部署指南 (Deployment Guide)

本项目已整合为 **前后端一体化包**，可以直接部署到 Linux 服务器。

## 1. 文件包说明

你拿到的 `server` 文件夹包含以下内容：
- **后端核心**：`index.js`, `package.json` 等
- **前端页面**：已构建并存放在 `public/` 目录下
- **数据库文件**：`data.json`, `cases.json` 等 (本地测试数据)
- **静态资源**：`public/uploads/` (包含所有高清图片和视频)

## 2. 服务器环境要求

确保目标 Linux 服务器安装了：
- **Node.js** (推荐 v16 或更高)
- **PM2** (进程守护工具): `npm install -g pm2`
- **Nginx** (反向代理 Web 服务器)

## 3. 部署步骤

### 第一步：上传文件
将整个 `server` 文件夹上传到服务器目录，例如 `/data/low-altitude/server`。

### 第二步：安装依赖
进入目录并安装 Node 依赖：
```bash
cd /data/low-altitude/server
npm install --production
```

### 第三步：启动服务
使用 PM2 启动服务（指定端口，例如 8090）：
```bash
# 如果有旧服务先删除
pm2 delete low-altitude-server

# 启动新服务 (PORT环境变量用于指定监听端口)
PORT=8090 pm2 start index.js --name "low-altitude-server"

# 检查是否成功启动
pm2 list
netstat -tlnp | grep 8090
```

### 第四步：Nginx 配置 (参考)
配置 Nginx 将域名流量转发到 8090 端口。

```nginx
server {
    listen 80;
    server_name your-domain.com; # 替换为实际域名

    # 静态文件缓存优化 (可选)
    location /assets/ {
        root /data/low-altitude/server/public;
        expires 30d;
    }

    # 所有请求转发给 Node 服务
    location / {
        proxy_pass http://127.0.0.1:8090;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

重启 Nginx：
```bash
nginx -t
systemctl reload nginx
```

## 4. 常见问题排查

1.  **启动报错 `Error: listen EADDRINUSE`**
    - 端口被占用。修改启动命令中的端口，例如 `PORT=8091`。

2.  **图片无法加载 (404 Not Found)**
    - 检查 `server/public/uploads` 目录是否存在且有文件。
    - 检查 Nginx 代理配置是否正确指向了 Node 服务端口。

3.  **上传文件失败 (Permission denied)**
    - 检查目录权限：`chmod -R 755 /data/low-altitude/server/public/uploads`
